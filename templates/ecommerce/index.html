{% load static %}
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href={% static 'ecommerce/style.css' %}>
    <title>Shopping Spree</title>
    <script type="text/javascript">
      ;(function (p, l, o, w, i, n, g) {
          if (!p[i]) {
              p.GlobalSnowplowNamespace = p.GlobalSnowplowNamespace || [];
              p.GlobalSnowplowNamespace.push(i);
              p[i] = function () {
                  (p[i].q = p[i].q || []).push(arguments)
              };
              p[i].q = p[i].q || [];
              n = l.createElement(o);
              g = l.getElementsByTagName(o)[0];
              n.async = 1;
              n.src = w;
              g.parentNode.insertBefore(n, g)
          }
      }(window, document, "script", "{% static 'ecommerce/sp.js' %}", "snowplow"));

      window.snowplow('newTracker', 'spmicro', '0.0.0.0:9090', { // Initialise a tracker

          encodeBase64: false,
          appId: 'sh0pspr33',
          platform: "web",
          discoverRootDomain: true,
          eventMethod: "beacon", // "post", "get", "beacon"
          contexts : {
              webPage: true
          }

      });
      window.snowplow('enableActivityTracking', 20, 20); // Ping every 10 seconds after 10 seconds
      window.snowplow('enableLinkClickTracking', null, true, true);
      window.snowplow('enableFormTracking');

      window.snowplow('trackPageView');

      // window.snowplow('trackSelfDescribingEvent', {
      //     schema: 'iglu:com.ecommerce.test/selection_event/jsonschema/1-0-0',
      //        data: {
      //            selection: 10,
      //            product_id: "hat",
      //            selected_value: 2}
      //   });

    </script>
    <!-- Snowplow stops plowing -->
    <script type="text/javascript">

    function dropdownChange(selection, product_id, selected_value){

        console.log(selected_value);
        console.log(selection);
        console.log(product_id);

    }


    </script>
</head>

<body>
  {% for product in product_list %}
  <!-- Product Detail -->
  <div class="wrapper">
    <div class="product">
      <div class="">
        <input type="image" class="product_img" src="/static/ecommerce/images/{{ product.image_name }}">
      </div>

      <div class="productItem">

        <div>{{ product.description }}</div>

        <div>
          <p>

            <form id="product_{{ product.id }}" method="post" action="javascript:void(0);">
              <ul>
                <li>
                  <label for="size-select">Size</label>
                  <select id="size-select" name="size" onchange="dropdownChange('Size', {{ product.id }}, this.value);">
                    <option value="" selected disabled hidden>Choose here</option>
                    {% for size in product.sizes %}
                    <option value = "{{ size }}">{{ size }}</option>
                    {% endfor %}
                  </select>
                </li>
                <li>
                  <label for="quant-select">Quantity</label>
                  <select id="quant-select" name="quantity" onchange="dropdownChange('Quantity', {{ product.id }}, this.value);">
                    <option value="" selected disabled hidden>Choose here</option>
                    {% for quantity in product.quantity %}
                    <option value = "{{ quantity }}">{{ quantity }}</option>
                    {% endfor %}
                  </select>
                </li>
                <li>
                  <label for="color-select">Colour</label>
                  <select id="color-select" name="color"onchange="dropdownChange('Colour', {{ product.id }}, this.value);">
                    <option value="" selected disabled hidden>Choose here</option>
                    {% for colour in product.colours %}
                    <option value = "{{ colour }}" style="color:red">{{ colour }}</option>
                    style="color:blue"
                    {% endfor %}
                  </select>
                </li>
                <li class="button">
                  <button type="submit">Add to basket</button>
                </li>
              </ul>
            </form>

          </p>
        </div>

      </div>

    </div>
  </div>
  {% endfor %}

</body>

</html>
